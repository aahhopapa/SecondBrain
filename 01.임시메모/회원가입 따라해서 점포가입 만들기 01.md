### 날짜 :  2022-08-17 14:13

### 인덱스 :

### 태그 : #ec-cube, #controller, #costomize, #GET


----

### 메모 :

먼저 기존 EC큐브의 소스를 보자

회원가입 전체 컨트롤러 소스 ↓
```php
  
    /**
     * 会員登録画面.
     *
     * @Route("/entry", name="entry", methods={"GET", "POST"})
     * @Route("/entry", name="entry_confirm", methods={"GET", "POST"})
     * @Template("Entry/index.twig")
     */
    public function index(Request $request)

    {
        if ($this->isGranted('ROLE_USER')) {
            log_info('認証済のためログイン処理をスキップ');
            return $this->redirectToRoute('mypage');
        }
  
        /** @var $Customer \Eccube\Entity\Customer */
        $Customer = $this->customerRepository->newCustomer();

        /* @var $builder \Symfony\Component\Form\FormBuilderInterface */
        $builder = $this->formFactory->createBuilder(EntryType::class, $Customer);

        $event = new EventArgs(
            [
                'builder' => $builder,
                'Customer' => $Customer,
            ],
            $request
        );

        $this->eventDispatcher->dispatch(EccubeEvents::FRONT_ENTRY_INDEX_INITIALIZE, $event);

        /* @var $form \Symfony\Component\Form\FormInterface */
        $form = $builder->getForm();
        $form->handleRequest($request);

        if ($form->isSubmitted() && $form->isValid()) {
            switch ($request->get('mode')) {
                case 'confirm':
                    log_info('会員登録確認開始');
                    log_info('会員登録確認完了');
                    return $this->render(
                        'Entry/confirm.twig',
                        [
                            'form' => $form->createView(),
                            'Page' => $this->pageRepository->getPageByRoute('entry_confirm'),
                        ]
                    );

                case 'complete':
                    log_info('会員登録開始');
                    $encoder = $this->encoderFactory->getEncoder($Customer);
                    $salt = $encoder->createSalt();
                    $password = $encoder->encodePassword($Customer->getPassword(), $salt);
                    $secretKey = $this->customerRepository->getUniqueSecretKey();
                    $Customer
                        ->setSalt($salt)
                        ->setPassword($password)
                        ->setSecretKey($secretKey)
                        ->setPoint(0);
                    $this->entityManager->persist($Customer);
                    $this->entityManager->flush();
  
                    log_info('会員登録完了');

                    $event = new EventArgs(
                        [
                            'form' => $form,
                            'Customer' => $Customer,
                        ],
                        $request
                    );

                    $this->eventDispatcher->dispatch(EccubeEvents::FRONT_ENTRY_INDEX_COMPLETE, $event);

                    $activateFlg = $this->BaseInfo->isOptionCustomerActivate();

                    // 仮会員設定が有効な場合は、確認メールを送信し完了画面表示.
                    if ($activateFlg) {
                        $activateUrl = $this->generateUrl('entry_activate', ['secret_key' => $Customer->getSecretKey()], UrlGeneratorInterface::ABSOLUTE_URL);

                        // メール送信
                        $this->mailService->sendCustomerConfirmMail($Customer, $activateUrl);

                        if ($event->hasResponse()) {
                            return $event->getResponse();
                        }

                        log_info('仮会員登録完了画面へリダイレクト');

                        return $this->redirectToRoute('entry_complete');
                    } else {
                        // 仮会員設定が無効な場合は、会員登録を完了させる.
                        $qtyInCart = $this->entryActivate($request, $Customer->getSecretKey());

                        // URLを変更するため完了画面にリダイレクト
                        return $this->redirectToRoute('entry_activate', [
                            'secret_key' => $Customer->getSecretKey(),
                            'qtyInCart' => $qtyInCart,
                        ]);
                    }
            }
        }

        return [
            'form' => $form->createView(),
        ];
    }
```

회원가입을 위해 많은 기능 처리가 들어가있다
겁먹지 말고 하나씩 만들어보자

먼저 커스텀 컨트롤러 하나 만들자
app/Customize/Contoller/
StoreEntryController.php를 하나 만들고
```php
<?php

namespace Customize\Controller;

use Sensio\Bundle\FrameworkExtraBundle\Configuration\Method;
use Sensio\Bundle\FrameworkExtraBundle\Configuration\Route;
use Symfony\Component\HttpFoundation\Response;

use Sensio\Bundle\FrameworkExtraBundle\Configuration\Template;


class StoreEntryController
{

    /**
     * 店舗登録画面.
     * @Method("GET")
     * @Route("/storeEntry")
     * @Template("StoreEntry/index.twig")
     */
    public function testMethod()
    {
        return [];
    }

}

```

app/template/default 에서 
(.env 파일에 ECCUBE_TEMPLATE_CODE=default로 되어있는경우 default가 기본 폴더 경로가 됨)
StoreEntry 폴더를 만들어주고 거기다가 index.twig를 만들어준다

```twig
{# index.twig #}

<h1>店舗登録画面</h1>
```

실행하는데 화면에 적용이 안될경우
CMD를 열어서 
프록시와 캐시 클리어 커맨드를 실행해준다
>Proxyの生成
>php C:\xampp\htdocs\ec-cube\bin\console eccube:generate:proxies

>キャッシュクリア
>php C:\xampp\htdocs\ec-cube\bin\console cache:clear --no-warmup

다시 브라우저를 통해서 확인해보면 잘나오는걸 확인 할수있다
![[20220817-02.png]]



----
### 출처 :
-


### 연결메모
-














